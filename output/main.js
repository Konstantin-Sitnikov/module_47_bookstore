(()=>{"use strict";new class{constructor(t){this.loadindex=0,this.key="AIzaSyAAe2ikW9G4PehhqDt_9eo0KZSXoj5-3WI",this.contentCategories=document.querySelector(".content__categories"),this.containerBookCards=document.querySelector(".content__container--book-cards"),this.headerContainerIconBasket=document.querySelector(".header__container--icon-basket"),this.headerContainerBasketNav=document.querySelector(".header__container--basket-nav"),this.loader=document.querySelector(".loader"),this.buttonLoadMore=document.querySelector(".button__load-more"),this.categorySearch="",this.categories=t,this.localStorage=new Array,this.addCategoriesToHtml()}async fetchData(){try{if(this.removeErrorWinodw(),this.loader.style.display="block",this.data=await fetch(`https://www.googleapis.com/books/v1/volumes?q="subject:${this.categorySearch}"&key=${this.key}&printType=books&startIndex=${this.loadindex}&maxResults=6&langRestrict=en`),this.response=await this.data.json(),this.response.error)throw new Error(`Что-то пошло не так: Код: ${this.response.error.code}, message: ${this.response.error.message}`);for(let t of this.response.items)this.addBookCards(t);this.loadindex+=6}catch(t){this.createErrorWinodw()}finally{this.loader.style.display="none",this.addButtonLoadMore()}}createErrorWinodw(){let t=document.createElement("div");t.classList.add("content__container","content__container--error");let e=document.createElement("img");e.src="../src/img/error.png",e.alt="error";let n=document.createElement("span");n.classList.add("content__error"),n.textContent="Sorry, something went wrong.",t.appendChild(e),t.appendChild(n),this.containerBookCards.appendChild(t)}removeErrorWinodw(){let t=document.querySelector(".content__container--error");t&&t.remove()}addButtonLoadMore(){let t=document.querySelector(".content__container--button");t&&t.remove();let e=document.createElement("div");e.classList.add("content__container","content__container--button");let n=document.createElement("button");n.classList.add("button","button__load-more"),n.textContent="load more",n.addEventListener("click",()=>{this.fetchData()}),e.appendChild(n),this.containerBookCards.appendChild(e)}addCategoriesToHtml(){for(let t of this.categories){let e=document.createElement("li");e.dataset.id=t,e.classList.add("content__item"),e.textContent=t,e.addEventListener("click",t=>{this.setActiveCategories(t.currentTarget.dataset.id)}),this.contentCategories.appendChild(e)}this.setActiveCategories(this.categories[0])}setActiveCategories(t){for(let t of this.contentCategories.querySelectorAll(".content__item"))t.classList.remove("content__item--active");this.contentCategories.querySelector(`[data-id="${t}"`).classList.add("content__item--active"),this.categorySearch=t,this.loadindex=0,this.containerBookCards.innerHTML="",this.fetchData()}addBookCards(t){let e=document.createElement("div");e.classList.add("book-cards");let n="";n=t.volumeInfo.imageLinks.thumbnail?t.volumeInfo.imageLinks.thumbnail:"../src/img/book.png";let o=document.createElement("img");o.src=n,o.alt="Foto book",o.classList.add("book-cards__img"),e.appendChild(o);let a=document.createElement("div");a.classList.add("book-cards__info");let s=document.createElement("span");s.classList.add("book-cards__authors"),s.textContent=t.volumeInfo.authors.join(", "),a.appendChild(s);let r=document.createElement("span");if(r.classList.add("book-cards__title"),r.textContent=t.volumeInfo.title,a.appendChild(r),t.volumeInfo.averageRating){let e=document.createElement("div");e.classList.add("book-cards__rating");let n=document.createElement("div");n.classList.add("book-cards__average-rating");let o=t.volumeInfo.averageRating;for(let t=1;t<=5;t++){let e=0;t<=Math.floor(o)&&(e=100),t===Math.floor(o)+1&&(e=Math.floor(o%1*100)),t>Math.floor(o)+1&&(e=0);let a=`<svg width="12" height="11" viewBox="0 0 12 11" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t<defs>\n\t\t\t\t\t\t\t\t<mask id="half_${t}">\n\t\t\t\t\t\t\t\t\t<rect x="0" y="0" width="12" height="11" fill="white" />\n\t\t\t\t\t\t\t\t\t<rect x="${e}%" y="0" width="12" height="11" fill="black" />\n\t\t\t\t\t\t\t\t</mask>\n\t\t\t\t\t\t\t\t<mask id="halfa_${t}">\n\t\t\t\t\t\t\t\t\t<rect x="0" y="0" width="12" height="11" fill="black" />\n\t\t\t\t\t\t\t\t\t<rect x="${e}%" y="0" width="12" height="11" fill="white" />\n\t\t\t\t\t\t\t\t</mask>\n\n\t\t\t\t\t\t\t\t<symbol viewBox="0 0 12 11" id="star">\n\t\t\t\t\t\t\t\t\t<path d="M5.70633 0L7.51201 3.5147L11.4127 4.1459L8.62798 6.9493L9.23304 10.8541L5.70633 9.072L2.17962 10.8541L2.78468 6.9493L-9.53674e-06 4.1459L3.90065 3.5147L5.70633 0Z"/>\n\t\t\t\t\t\t\t\t</symbol>\n\n\n\t\t\t\t\t\t\t\t</defs>\n\t\t\t\t\t\t\t\t\t<use xlink:href="#star" mask="url(#half_${t})" fill="#F2C94C"></use>\n\t\t\t\t\t\t\t\t\t<use xlink:href="#star" mask="url(#halfa_${t})" fill="#EEEDF5"></use>\n\t\t\t\t\t\t\t\t</svg>`;n.innerHTML+=a}e.appendChild(n);let s=document.createElement("span");s.classList.add("book-cards__ratings-count"),s.textContent=t.volumeInfo.ratingsCount+" review",e.appendChild(s),a.appendChild(e)}let i="";i=t.volumeInfo.description?t.volumeInfo.description:"not description";let l=document.createElement("span");l.classList.add("book-cards__description"),l.textContent=i,a.appendChild(l);let c=t.saleInfo.saleability,d="",h="",m="";"FOR_SALE"===c&&(d="RUB"===t.saleInfo.retailPrice.currencyCode?`${t.saleInfo.retailPrice.amount} ${t.saleInfo.retailPrice.currencyCode}`:`${t.saleInfo.retailPrice.currencyCode} ${t.saleInfo.retailPrice.amount}`,h="button__book-cards",m="buy now"),"FREE"===c&&(d="FREE",h="button__book-cards",m="buy now"),"NOT_FOR_SALE"===c&&(h="button__book-cards--not-sale",m="not sale");let u=document.createElement("span");u.classList.add("book-cards__price"),u.textContent=d,a.appendChild(u);let _=document.createElement("button");_.dataset.id=t.id,_.classList.add("button","button__book-cards",`${h}`),_.textContent=m,_.addEventListener("click",t=>{this.addRemovInBasket(t)}),a.appendChild(_),e.appendChild(a),this.containerBookCards.appendChild(e)}addRemovInBasket(t){let e=t.currentTarget;e.classList.contains("button__book-cards--not-sale")||(e.classList.contains("button__book-cards--active")?(e.classList.remove("button__book-cards--active"),this.localStorage.splice(this.localStorage.indexOf(e.dataset.id)),e.textContent="buy now"):(e.classList.add("button__book-cards--active"),e.textContent="in the cart",this.localStorage.push(e.dataset.id)),0!=this.localStorage.length?(this.headerContainerIconBasket.textContent=this.localStorage.length,this.headerContainerIconBasket.style.display="flex",this.headerContainerBasketNav.textContent=this.localStorage.length,this.headerContainerBasketNav.style.display="flex"):(this.headerContainerIconBasket.textContent="",this.headerContainerIconBasket.style.display="none",this.headerContainerBasketNav.textContent="",this.headerContainerBasketNav.style.display="none"))}}(["Architecture","Art & Fashion","Biography","Business","Crafts & Hobbies","Drama","Fiction","Food & Drink","Health & Wellbeing","History & Politics","Humor","Poetry","Psychology","Science","Technology","Travel & Maps"]),new class{constructor(t){this.imageCount=0,this.list=t,this.startAutoScroll=null,this.timer=5e3,this.contentImgBanner=document.querySelector(".content__container--img-slider"),this.contentContainerMarkers=document.querySelector(".content__container--markers"),this.addMarkersToHtml(),this.startScroll()}setCount(t){this.imageCount=t}getCount(){return this.imageCount}setTimer(t){this.timer=t}addActiveMarker(t){this.contentMarker=document.querySelectorAll(".content__marker");for(let e of this.contentMarker)e.classList.remove("content__marker--active"),e.dataset.id===t&&e.classList.add("content__marker--active")}addBannerToHtml(t){this.contentImgBanner.innerHTML=`<img class="content__img content__img--banner" src=${this.list[t]} alt="Фото">`,this.addActiveMarker(String(t))}addMarkersToHtml(){for(let t=0;t<this.list.length;t++){let e=document.createElement("div");e.dataset.id=t,e.classList.add("content__marker"),e.addEventListener("click",t=>{let e=t.currentTarget.dataset.id;this.addBannerToHtml(Number(e)),this.setCount(Number(e)),this.startScroll()}),this.contentContainerMarkers.appendChild(e)}this.addBannerToHtml(0)}Scroll(){this.imageCount+=1,this.imageCount<this.list.length||(this.imageCount=0),this.addBannerToHtml(this.imageCount)}startScroll(){this.startAutoScroll&&clearInterval(this.startAutoScroll),this.startAutoScroll=setInterval(this.Scroll.bind(this),this.timer)}}(["../src/img/banner.png","../src/img/banner2.png","../src/img/banner3.png"])})();